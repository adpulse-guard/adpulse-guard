!function(){if(!window.APG_CONFIG)return;const e=new Set,t=Object.assign({},{ignoreAnchorSlots:!0,apiEndpoint:"https://script.google.com/macros/s/AKfycbxAD4aNij0ApHx21r68hq5TLx2k2r3VT9_obEe7I-EX_l3JGDQSnrY84LcA4QG8Ldf2ig/exec",version:"start-1.3.0-enterprise",scanScheduleMs:[3500,1e4,4e4],dedupeTtlMs:864e5,domSlotSelector:'div[id^="div-gpt-ad"],div[id^="gpt-"],div[id^="ad-"],div[id*="ad-slot"],div[id*="gpt-ad"],div[id*="slot"]',revenueModel:{currency:"USD",assumedRpm:1,assumedImpressionsPerHour:500}},window.APG_CONFIG),o=!!t.debug;if(!t.clientId||!t.siteToken)return;location.hostname.replace(/^www\./,"");const n=Date.now().toString(36)+"-"+Math.random().toString(36).slice(2,8),s=[],i=new Set;let r=!1,d=!1,l=!1;const a=["1x1","2x1"];function c(e){return"string"==typeof e&&e.startsWith("google_pubconsole_overlay_")}function u(e){if(!e)return!0;if(c(e.id))return!0;return"fixed"===window.getComputedStyle(e).position||(e.offsetWidth<10||e.offsetHeight<10)}function g(e){if("string"!=typeof e)return"";const t=e.match(/^\/(\d+)\//);return t?t[1]:""}function m(e){try{if(!e)return!0;if(t.ignoreAnchorSlots&&e.getOutOfPage?.())return!0;const o=e.getSlotElementId?.();if(!o)return!0;const n=document.getElementById(o);if(!n)return!1;const s=window.getComputedStyle(n);if("fixed"===s.position)return!0;if("sticky"===s.position)return!0}catch{}return!1}function h(e,t,o=20){const n=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left)),s=Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));return n>o&&s>o}function p(e){if(e.slotId&&c(e.slotId))return;const t=e.severity||("slot_not_registered"===(o=e.issueType)||"gpt_loaded_but_not_initialized"===o||"gpt_script_missing"===o||"gpt_no_slot_requests"===o||"wrong_network"===o||"phantom_slot_requested"===o?"high":["empty_response","unexpected_size","defined_without_dom_no_request","slot_container_collapsed"].includes(o)?"medium":"low");var o;const n=e.issueType+"|"+(e.slotId||"");i.has(n)||(i.add(n),s.push({issueType:e.issueType,slotId:e.slotId||"",adUnitPath:e.adUnitPath||"",networkId:e.networkId||"",hadRequest:e.hadRequest||!1,hadResponse:e.hadResponse||!1,renderedSize:e.renderedSize,definedSizes:e.definedSizes,scanAttempt:e.scanAttempt,scanDelayMs:e.scanDelayMs,severity:t}),console.log("[APG] issue detected:",e.issueType,e.slotId))}function f(e){try{const o="__global__"===e.slotId?location.href:location.hostname,n=["apg",t.clientId,o,e.issueType,e.slotId||""].join("|"),s=localStorage.getItem(n);return!(s&&Date.now()-Number(s)<t.dedupeTtlMs)&&(localStorage.setItem(n,String(Date.now())),!0)}catch{return!0}}let _=!1;function y(e,o){if(!e.length)return;const s=e.filter(f);if(!s.length)return;const i=(()=>{const e=new Set(Array.from(document.querySelectorAll(t.domSlotSelector)).filter((e=>!u(e))).map((e=>e.id)).filter((e=>e&&!c(e))));if(e.size)return e.size;return new Set(Array.from(document.querySelectorAll('div[id^="div-gpt-ad"]')).map((e=>e.id)).filter((e=>e&&!c(e)))).size})();let r=new Set(s.map((e=>e.slotId)).filter((e=>e&&"__global__"!==e))).size;s.some((e=>"gpt_loaded_but_not_initialized"===e.issueType||"gpt_script_missing"===e.issueType||"gpt_no_slot_requests"===e.issueType))&&i>0&&(r=i);const d=function(e=1){const o=t.revenueModel.assumedImpressionsPerHour/1e3*t.revenueModel.assumedRpm;return{estimationCurrency:t.revenueModel.currency,assumedRpm:t.revenueModel.assumedRpm,assumedImpressionsPerHour:t.revenueModel.assumedImpressionsPerHour,estimatedHourlyRevenueRisk:Math.round(o*e*100)/100,estimatedDailyRevenueRisk:Math.round(24*o*e*100)/100,estimationMethod:"conservative_time_based_risk",revenueAssumptionsNote:"500 imps/hour, $1 RPM baseline"}}(r),l=Object.assign({clientId:t.clientId,siteToken:t.siteToken,host:location.hostname,pageUrl:location.href,pageLoadId:n,phase:o,affectedSlotCount:r,expectedSlotCount:i,timestamp:(new Date).toISOString(),tagVersion:t.version,issueType:"multiple_issues",severity:s.some((e=>"high"===e.severity))?"high":s.some((e=>"medium"===e.severity))?"medium":"info",issues:s},d);fetch(t.apiEndpoint,{method:"POST",headers:{"Content-Type":"text/plain;charset=UTF-8"},body:JSON.stringify(l),keepalive:!0}).catch((()=>{}))}function S(){d||s.length&&(d=!0,y(s,"final"))}function I(n){const s=Array.from(document.scripts).some((e=>e.src&&(e.src.includes("gpt.js")||e.src.includes("securepubads.g.doubleclick.net")))),i=(Array.from(document.querySelectorAll(t.domSlotSelector)).filter((e=>!u(e))).map((e=>e.id)).filter(Boolean),Array.from(document.querySelectorAll(t.domSlotSelector)).map((e=>e.id)).filter((e=>e&&!c(e)))),l=new Set(i).size;if(!s)return void(n!==t.scanScheduleMs.length-1||d||p({issueType:"gpt_script_missing",slotId:"__global__",scanAttempt:n+1,scanDelayMs:t.scanScheduleMs[n],severity:"high"}));if(!window.googletag)return void(n!==t.scanScheduleMs.length-1||d||p({issueType:"gpt_script_missing",slotId:"__global__",scanAttempt:n+1,scanDelayMs:t.scanScheduleMs[n],severity:"high"}));if(!(window.googletag&&"function"==typeof googletag.pubads&&"function"==typeof googletag.enableServices)){if(n===t.scanScheduleMs.length-1&&!d){p({issueType:s?"gpt_loaded_but_not_initialized":"gpt_script_missing",slotId:"__global__",affectedSlotCountHint:l,scanAttempt:n+1,scanDelayMs:t.scanScheduleMs[n],severity:"high"})}return}const f=Array.from(document.querySelectorAll(t.domSlotSelector)).filter((e=>!u(e))).map((e=>e.id)).filter(Boolean),y=googletag.pubads().getSlots(),I=y.map((e=>e.getSlotElementId?.())).filter((e=>e&&!c(e))),w=y.filter((e=>!m(e)&&!e.getSizes().some((e=>{const t=e.getWidth?.(),o=e.getHeight?.();return a.includes(`${t}x${o}`)}))));1!==n||d||w.forEach((o=>{const s=o.getSlotElementId?.();if(!s||c(s))return;if(m(o))return;if(document.getElementById(s))return;const i=o.getAdUnitPath?.()||"",r=g(i);if(t.expectedNetworkId&&r&&String(r)!==String(t.expectedNetworkId))return;const d=e.has(s),l=!!o.getResponseInformation?.();d&&l&&p({issueType:"phantom_slot_requested",slotId:s,adUnitPath:i,hadRequest:d,hadResponse:l,scanAttempt:n+1,scanDelayMs:t.scanScheduleMs[n],severity:"high"})}));w.map((e=>e.getSlotElementId?.())).filter((e=>e&&!c(e)));if(f.forEach((e=>{I.includes(e)||p({issueType:"slot_not_registered",slotId:e,scanAttempt:n+1,scanDelayMs:t.scanScheduleMs[n]})})),w.forEach((o=>{const s=o.getSlotElementId?.();if(!s||c(s))return;const i=o.getAdUnitPath?.();if(!i)return;const d=g(i);d&&(t.expectedNetworkId&&d&&String(d)!==String(t.expectedNetworkId)&&p({issueType:"wrong_network",slotId:s,adUnitPath:i,networkId:d,hadRequest:!0,hadResponse:!!o.getResponseInformation?.(),scanAttempt:n+1,scanDelayMs:t.scanScheduleMs[n]}),n===t.scanScheduleMs.length-1&&(_||(_=!0,function(){try{r=!0,window.scrollTo(0,.8*document.body.scrollHeight),setTimeout((()=>{r=!1}),1500),window.googletag&&"function"==typeof googletag.pubads&&googletag.cmd.push((function(){googletag.pubads().refresh(googletag.pubads().getSlots().filter((e=>{const t=e.getSlotElementId();return t&&!document.getElementById(t)})))}))}catch{}}()),setTimeout((()=>{const o=googletag.pubads().getSlots().filter((e=>!m(e)&&!e.getSizes().some((e=>{const t=e.getWidth?.(),o=e.getHeight?.();return a.includes(`${t}x${o}`)})))),s=o.map((e=>e.getSlotElementId())).filter((e=>e&&!c(e))),i=performance.getEntriesByType("resource").some((e=>e.name.includes("gampad")));o.length>0&&0===e.size&&!i&&p({issueType:"gpt_no_slot_requests",slotId:"__global__",severity:"high"}),o.forEach((o=>{if(m(o))return;const n=o.getSlotElementId?.();if(!n||c(n))return;const s=document.getElementById(n);if(s&&s.offsetWidth>0&&0===s.offsetHeight&&p({issueType:"slot_container_collapsed",slotId:n,severity:"medium"}),!o.getSizes?.().some((e=>a.includes(`${e.getWidth?.()}x${e.getHeight?.()}`)))&&!document.getElementById(n)){const s=o.getAdUnitPath?.()||"",i=g(s);if(t.expectedNetworkId&&i&&String(i)!==String(t.expectedNetworkId))return;const r=e.has(n),d=!!o.getResponseInformation?.(),l=r||d;p({issueType:l?"phantom_slot_requested":"defined_without_dom_no_request",slotId:n,adUnitPath:s,hadRequest:r,hadResponse:d,severity:l?"high":"medium"})}})),s.forEach((e=>{const o=document.getElementById(e);if(!o)return;if(!o.querySelector("iframe"))return;const i=o.getBoundingClientRect(),d=Math.max(0,Math.min(i.bottom,window.innerHeight)-Math.max(i.top,0)),l=i.height>0?d/i.height:0,a=i.width>0&&i.height>0&&l>=.5;r||a&&setTimeout((()=>{if(r)return;if(!document.body.contains(o))return;const i=o.getBoundingClientRect(),d=Math.max(0,Math.min(i.bottom,window.innerHeight)-Math.max(i.top,0)),l=i.height>0?d/i.height:0;if(l<.5)return;i.width>0&&i.height;r||function(e,t){const o=e.getBoundingClientRect(),n=Math.max(0,Math.min(o.bottom,window.innerHeight)-Math.max(o.top,0));if((o.height>0?n/o.height:0)<.5)return!1;const s=o.left+o.width/2,i=o.top+o.height/2,r=document.elementsFromPoint(s,i);if(!r.length)return!1;const d=r[0];return!(d===e||e.contains(d)||"IFRAME"===d.tagName&&e.contains(d)||d.id&&/^google_ads_iframe_/.test(d.id)||d.id&&d.id.includes("__container__")||d.id&&t.includes(d.id))}(o,s)&&p({issueType:"ad_visibility_impaired",slotId:e,scanAttempt:n+1,scanDelayMs:t.scanScheduleMs[n]})}),800)}));const d=s.map((e=>document.getElementById(e))).filter((e=>e&&e.offsetWidth>0&&e.offsetHeight>0)).map((e=>({id:e.id,rect:e.getBoundingClientRect()})));for(let e=0;e<d.length;e++)for(let o=e+1;o<d.length;o++){const s=d[e],i=d[o];h(s.rect,i.rect)&&p({issueType:"layout_overlap",slotId:`${s.id} â†” ${i.id}`,scanAttempt:n+1,scanDelayMs:t.scanScheduleMs[n]})}setTimeout((()=>{S()}),1200)}),500)))})),o&&n===t.scanScheduleMs.length-1){const e=Array.from(document.querySelectorAll(t.domSlotSelector)).map((e=>e.id)).filter(Boolean),o=(window.googletag&&"function"==typeof googletag.pubads?googletag.pubads().getSlots().map((e=>e.getSlotElementId())):[]).filter(Boolean),n=o.filter((t=>!e.includes(t))),s=e.filter((e=>!o.includes(e)));console.group("[APG DEBUG]"),console.log("DOM count:",e.length),console.log("GPT count:",o.length),console.log("Phantom slots:",n),console.log("Orphan DOM slots:",s),console.groupEnd()}}const w=Math.max(...t.scanScheduleMs);setTimeout((()=>{!d&&s.length&&S()}),w+3e3),(window.googletag=window.googletag||{cmd:[]}).cmd.push((function(){const o=googletag.pubads();o.__apgBound||(o.__apgBound=!0,o.addEventListener("slotRequested",(function(t){const o=t.slot?.getSlotElementId?.();o&&e.add(o)})),o.addEventListener("slotRenderEnded",(function(e){if(m(e.slot))return;const o=e.slot?.getSlotElementId?.();if(!o||c(o))return;const n=e.slot?.getAdUnitPath?.()||"";let s=!1;const i=g(n);if(t.expectedNetworkId&&i&&String(i)!==String(t.expectedNetworkId)&&(s=!0,p({issueType:"wrong_network",slotId:o,adUnitPath:n,networkId:i})),!s&&e.isEmpty&&p({issueType:"empty_response",slotId:o,adUnitPath:n}),e.size&&e.slot?.getSizes){const t=e.size[0]+"x"+e.size[1],s=e.slot.getSizes().map((e=>e.getWidth()+"x"+e.getHeight()));s.includes(t)||p({issueType:"unexpected_size",slotId:o,adUnitPath:n,renderedSize:t,definedSizes:s})}})))})),t.scanScheduleMs.forEach(((e,t)=>setTimeout((()=>I(t)),e))),window.addEventListener("beforeunload",(()=>{l||d||s.length&&(l=!0,y(s,"early_exit"))}))}();
