!function(){if(!window.APG_CONFIG)return;const e=Object.assign({},{ignoreAnchorSlots:!0,apiEndpoint:"https://script.google.com/macros/s/AKfycbxAD4aNij0ApHx21r68hq5TLx2k2r3VT9_obEe7I-EX_l3JGDQSnrY84LcA4QG8Ldf2ig/exec",version:"start-1.2.0-appscript",scanScheduleMs:[3500,1e4,4e4],dedupeTtlMs:864e5,domSlotSelector:'div[id^="div-gpt-ad"],div[id^="gpt-"],div[id^="ad-"],div[id*="ad-slot"],div[id*="gpt-ad"],div[id*="slot"]',revenueModel:{currency:"USD",assumedRpm:1,assumedImpressionsPerHour:500}},window.APG_CONFIG),t=!!e.debug;if(!e.clientId||!e.siteToken)return;location.hostname.replace(/^www\./,"");const o=Date.now().toString(36)+"-"+Math.random().toString(36).slice(2,8),n=[],i=new Set;let s=null,r=!1;const d=["1x1","2x1"];function l(e){return"string"==typeof e&&e.startsWith("google_pubconsole_overlay_")}function a(e){if(!e)return!0;if(l(e.id))return!0;return"fixed"===window.getComputedStyle(e).position||(e.offsetWidth<10||e.offsetHeight<10)}function c(e){if("string"!=typeof e)return"";const t=e.match(/^\/(\d+)\//);return t?t[1]:""}function u(t){try{if(!t)return!0;if(e.ignoreAnchorSlots&&t.getOutOfPage?.())return!0;const o=t.getSlotElementId?.();if(!o)return!0;const n=document.getElementById(o);if(!n)return!1;const i=window.getComputedStyle(n);if("fixed"===i.position)return!0;if("sticky"===i.position)return!0}catch{}return!1}function g(e,t,o=20){const n=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left)),i=Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));return n>o&&i>o}function m(t){try{const o=["apg",e.clientId,location.href,t.issueType,t.slotId||""].join("|"),n=localStorage.getItem(o);return!(n&&Date.now()-Number(n)<e.dedupeTtlMs)&&(localStorage.setItem(o,String(Date.now())),!0)}catch{return!0}}function p(e){if(e.slotId&&l(e.slotId))return;const t=e.issueType+"|"+(e.slotId||"");var o;i.has(t)||(i.add(t),n.push({issueType:e.issueType,slotId:e.slotId||"",adUnitPath:e.adUnitPath||"",networkId:e.networkId||"",renderedSize:e.renderedSize,definedSizes:e.definedSizes,scanAttempt:e.scanAttempt,scanDelayMs:e.scanDelayMs,severity:e.severity||(o=e.issueType,"slot_not_registered"===o||"gpt_not_loaded"===o||"wrong_network"===o?"high":["empty_response","unexpected_size","defined_without_dom"].includes(o)?"medium":"low")}),console.log("[APG] issue detected:",e.issueType,e.slotId))}let f=!1;function h(){if(!n.length)return;if(r)return;r=!0;const t=n.filter(m);if(!t.length)return;const i=Array.from(document.querySelectorAll(e.domSlotSelector)).filter((e=>!a(e))).map((e=>e.id)).filter(Boolean).length,s=Object.assign({clientId:e.clientId,siteToken:e.siteToken,host:location.hostname,clientIdFromConfig:e.clientId,expectedNetworkIdFromConfig:e.expectedNetworkId||"",allowedDomainFromConfig:e.allowedDomain||"",pageUrl:location.href,expectedSlotCount:i,timestamp:(new Date).toISOString(),tagVersion:e.version,pageLoadId:o,issueType:"multiple_issues",severity:t.some((e=>"high"===e.severity))?"high":t.some((e=>"medium"===e.severity))?"medium":"info",issues:t},function(){const t=e.revenueModel.assumedImpressionsPerHour/1e3*e.revenueModel.assumedRpm;return{estimationCurrency:e.revenueModel.currency,assumedRpm:e.revenueModel.assumedRpm,assumedImpressionsPerHour:e.revenueModel.assumedImpressionsPerHour,estimatedHourlyRevenueRisk:Math.round(100*t)/100,estimatedDailyRevenueRisk:Math.round(24*t*100)/100,estimationMethod:"conservative_time_based_risk",revenueAssumptionsNote:"500 imps/hour, $1 RPM, conservative baseline"}}());fetch(e.apiEndpoint,{method:"POST",headers:{"Content-Type":"text/plain;charset=UTF-8"},body:JSON.stringify(s)}).catch((()=>{}))}function y(e=1500){r||(clearTimeout(s),s=setTimeout((()=>{h()}),e))}function S(o){if(!window.googletag||!googletag.apiReady)return void(o===e.scanScheduleMs.length-1&&(p({issueType:"gpt_not_loaded",scanAttempt:o+1,scanDelayMs:e.scanScheduleMs[o]}),y()));const n=Array.from(document.querySelectorAll(e.domSlotSelector)).filter((e=>!a(e))).map((e=>e.id)).filter(Boolean),i=googletag.pubads().getSlots(),s=i.map((e=>e.getSlotElementId?.())).filter((e=>e&&!l(e))),r=i.filter((e=>!u(e)&&!e.getSizes().some((e=>{const t=e.getWidth?.(),o=e.getHeight?.();return d.includes(`${t}x${o}`)}))));r.map((e=>e.getSlotElementId?.())).filter((e=>e&&!l(e)));if(n.forEach((t=>{s.includes(t)||p({issueType:"slot_not_registered",slotId:t,scanAttempt:o+1,scanDelayMs:e.scanScheduleMs[o]})})),r.forEach((t=>{const n=t.getSlotElementId?.();if(!n||l(n))return;const i=t.getAdUnitPath?.();if(!i)return;const s=c(i);s&&(e.expectedNetworkId&&String(s)!==String(e.expectedNetworkId)&&p({issueType:"wrong_network",slotId:n,adUnitPath:i,networkId:s,scanAttempt:o+1,scanDelayMs:e.scanScheduleMs[o]}),o===e.scanScheduleMs.length-1&&(f||(f=!0,function(){try{window.scrollTo(0,.8*document.body.scrollHeight),window.googletag&&googletag.apiReady&&googletag.cmd.push((function(){googletag.pubads().refresh()}))}catch{}}()),setTimeout((()=>{const t=googletag.pubads().getSlots().filter((e=>!u(e)&&!e.getSizes().some((e=>{const t=e.getWidth?.(),o=e.getHeight?.();return d.includes(`${t}x${o}`)})))),n=t.map((e=>e.getSlotElementId())).filter((e=>e&&!l(e)));t.forEach((t=>{if(u(t))return;const n=t.getSlotElementId?.();n&&!l(n)&&(document.getElementById(n)||p({issueType:"defined_without_dom",slotId:n,adUnitPath:t.getAdUnitPath?.(),scanAttempt:o+1,scanDelayMs:e.scanScheduleMs[o]}))})),n.forEach((t=>{const i=document.getElementById(t);if(!i)return;i.querySelector("iframe")&&(window.outerWidth-window.innerWidth>200||function(e,t){const o=e.getBoundingClientRect();if(o.bottom<0||o.top>window.innerHeight)return!1;const n=[[o.left+5,o.top+5],[o.right-5,o.top+5],[o.left+5,o.bottom-5],[o.right-5,o.bottom-5],[o.left+o.width/2,o.top+o.height/2]];let i=0;for(const[o,s]of n)document.elementsFromPoint(o,s).some((o=>{if(o===e)return!1;if(e.contains(o))return!1;if(o.id&&t.includes(o.id))return!1;if(o===e.parentElement)return!1;const n=window.getComputedStyle(o);return"none"!==n.pointerEvents&&"hidden"!==n.visibility&&"none"!==n.display}))&&i++;return i>=2}(i,n)&&p({issueType:"ad_visibility_impaired",slotId:t,scanAttempt:o+1,scanDelayMs:e.scanScheduleMs[o]}))}));const i=n.map((e=>document.getElementById(e))).filter((e=>e&&e.offsetWidth>0&&e.offsetHeight>0)).map((e=>({id:e.id,rect:e.getBoundingClientRect()})));for(let t=0;t<i.length;t++)for(let n=t+1;n<i.length;n++){const s=i[t],r=i[n];g(s.rect,r.rect)&&p({issueType:"layout_overlap",slotId:`${s.id} â†” ${r.id}`,scanAttempt:o+1,scanDelayMs:e.scanScheduleMs[o]})}y()}),500)))})),t){const t=Array.from(document.querySelectorAll(e.domSlotSelector)).map((e=>e.id)).filter(Boolean),o=(window.googletag?.apiReady?googletag.pubads().getSlots().map((e=>e.getSlotElementId())):[]).filter(Boolean),n=o.filter((e=>!t.includes(e))),i=t.filter((e=>!o.includes(e)));console.group("[APG DEBUG]"),console.log("DOM count:",t.length),console.log("GPT count:",o.length),console.log("Phantom slots:",n),console.log("Orphan DOM slots:",i),console.groupEnd()}}(window.googletag=window.googletag||{cmd:[]}).cmd.push((function(){const t=googletag.pubads();t.__apgBound||(t.__apgBound=!0,t.addEventListener("slotRenderEnded",(function(t){if(u(t.slot))return;const o=t.slot?.getSlotElementId?.();if(!o||l(o))return;const n=t.slot?.getAdUnitPath?.()||"";let i=!1;const s=c(n);if(e.expectedNetworkId&&s&&String(s)!==String(e.expectedNetworkId)&&(i=!0,p({issueType:"wrong_network",slotId:o,adUnitPath:n,networkId:s}),y()),!i&&t.isEmpty&&(p({issueType:"empty_response",slotId:o,adUnitPath:n}),y()),t.size&&t.slot?.getSizes){const e=t.size[0]+"x"+t.size[1],i=t.slot.getSizes().map((e=>e.getWidth()+"x"+e.getHeight()));i.includes(e)||(p({issueType:"unexpected_size",slotId:o,adUnitPath:n,renderedSize:e,definedSizes:i}),y())}})))})),e.scanScheduleMs.forEach(((e,t)=>setTimeout((()=>S(t)),e)))}();
