!function(){if(!window.APG_CONFIG)return;const e=new Set,t=Object.assign({},{ignoreAnchorSlots:!0,apiEndpoint:"https://script.google.com/macros/s/AKfycbxAD4aNij0ApHx21r68hq5TLx2k2r3VT9_obEe7I-EX_l3JGDQSnrY84LcA4QG8Ldf2ig/exec",version:"start-1.2.0-appscript",scanScheduleMs:[3500,1e4,4e4],dedupeTtlMs:864e5,domSlotSelector:'div[id^="div-gpt-ad"],div[id^="gpt-"],div[id^="ad-"],div[id*="ad-slot"],div[id*="gpt-ad"],div[id*="slot"]',revenueModel:{currency:"USD",assumedRpm:1,assumedImpressionsPerHour:500}},window.APG_CONFIG),s=!!t.debug;if(!t.clientId||!t.siteToken)return;location.hostname.replace(/^www\./,"");const n=Date.now().toString(36)+"-"+Math.random().toString(36).slice(2,8),o=[],i=new Set;let r=null,d=!1;const l=["1x1","2x1"];function a(e){return"string"==typeof e&&e.startsWith("google_pubconsole_overlay_")}function c(e){if(!e)return!0;if(a(e.id))return!0;return"fixed"===window.getComputedStyle(e).position||(e.offsetWidth<10||e.offsetHeight<10)}function u(e){if("string"!=typeof e)return"";const t=e.match(/^\/(\d+)\//);return t?t[1]:""}function g(e){try{if(!e)return!0;if(t.ignoreAnchorSlots&&e.getOutOfPage?.())return!0;const s=e.getSlotElementId?.();if(!s)return!0;const n=document.getElementById(s);if(!n)return!1;const o=window.getComputedStyle(n);if("fixed"===o.position)return!0;if("sticky"===o.position)return!0}catch{}return!1}function p(e,t,s=20){const n=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left)),o=Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));return n>s&&o>s}function m(e){try{const s=["apg",t.clientId,location.href,e.issueType,e.slotId||""].join("|"),n=localStorage.getItem(s);return!(n&&Date.now()-Number(n)<t.dedupeTtlMs)&&(localStorage.setItem(s,String(Date.now())),!0)}catch{return!0}}function h(e){if(e.slotId&&a(e.slotId))return;const t=e.issueType+"|"+(e.slotId||"");var s;i.has(t)||(i.add(t),o.push({issueType:e.issueType,slotId:e.slotId||"",adUnitPath:e.adUnitPath||"",networkId:e.networkId||"",hadRequest:e.hadRequest||!1,hadResponse:e.hadResponse||!1,renderedSize:e.renderedSize,definedSizes:e.definedSizes,scanAttempt:e.scanAttempt,scanDelayMs:e.scanDelayMs,severity:e.severity||(s=e.issueType,"slot_not_registered"===s||"gpt_not_initialized"===s||"gpt_script_missing"===s||"gpt_no_slot_requests"===s||"wrong_network"===s||"phantom_slot_requested"===s?"high":["empty_response","unexpected_size","defined_without_dom_no_request","slot_container_collapsed"].includes(s)?"medium":"paywalled_page"===s?"info":"low")}),console.log("[APG] issue detected:",e.issueType,e.slotId))}let f=!1;function y(){if(!o.length)return;if(d)return;d=!0;const e=o.filter(m);if(!e.length)return;const s=e.filter((e=>"paywalled_page"===e.issueType)),i=e.filter((e=>"paywalled_page"!==e.issueType));if(!i.length&&s.length){const e={clientId:t.clientId,siteToken:t.siteToken,host:location.hostname,pageUrl:location.href,issueType:"multiple_issues",severity:"info",affectedSlotCount:0,expectedSlotCount:0,pageLoadId:n,timestamp:(new Date).toISOString(),tagVersion:t.version,issues:s,estimatedHourlyRevenueRisk:0,estimatedDailyRevenueRisk:0};return void fetch(t.apiEndpoint,{method:"POST",headers:{"Content-Type":"text/plain;charset=UTF-8"},body:JSON.stringify(e)})}if(!i.length)return;const r=Array.from(document.querySelectorAll(t.domSlotSelector)).filter((e=>!c(e))).map((e=>e.id)).filter(Boolean).length,l=i.some((e=>"gpt_not_initialized"===e.issueType||"gpt_script_missing"===e.issueType)),a=new Set(i.map((e=>e.slotId)).filter(Boolean)),u=(l?r:a.size)||1,g=function(){const e=t.revenueModel.assumedImpressionsPerHour/1e3*t.revenueModel.assumedRpm;return{estimationCurrency:t.revenueModel.currency,assumedRpm:t.revenueModel.assumedRpm,assumedImpressionsPerHour:t.revenueModel.assumedImpressionsPerHour,estimatedHourlyRevenueRisk:Math.round(100*e)/100,estimatedDailyRevenueRisk:Math.round(24*e*100)/100,estimationMethod:"conservative_time_based_risk",revenueAssumptionsNote:"500 imps/hour, $1 RPM, conservative baseline"}}(),p={...g,estimatedHourlyRevenueRisk:g.estimatedHourlyRevenueRisk*u,estimatedDailyRevenueRisk:g.estimatedDailyRevenueRisk*u},h=Object.assign({clientId:t.clientId,siteToken:t.siteToken,host:location.hostname,pageUrl:location.href,affectedSlotCount:u,expectedSlotCount:r,timestamp:(new Date).toISOString(),tagVersion:t.version,pageLoadId:n,issueType:"multiple_issues",severity:i.some((e=>"high"===e.severity))?"high":i.some((e=>"medium"===e.severity))?"medium":"info",issues:i,contextSignals:s},p);fetch(t.apiEndpoint,{method:"POST",headers:{"Content-Type":"text/plain;charset=UTF-8"},body:JSON.stringify(h)}).catch((()=>{}))}function S(e=1500){d||(clearTimeout(r),r=setTimeout((()=>{y()}),e))}function _(n){const o=document.body?.className?.toLowerCase()||"";if(/subscriber|subscribe|paywall|premium|member/.test(o)||!!document.querySelector('[class*="subscriber"],[id*="subscriber"],[class*="subscribe"],[id*="subscribe"],[class*="paywall"],[id*="paywall"],[class*="premium"],[id*="premium"],[class*="member"],[id*="member"]'))return void(n===t.scanScheduleMs.length-1&&(h({issueType:"paywalled_page",severity:"info"}),S()));if(!Array.from(document.scripts).some((e=>e.src&&e.src.includes("gpt"))))return void(n===t.scanScheduleMs.length-1&&(h({issueType:"gpt_script_missing",scanAttempt:n+1,scanDelayMs:t.scanScheduleMs[n]}),S()));if(!window.googletag)return void(n===t.scanScheduleMs.length-1&&(h({issueType:"gpt_script_missing",scanAttempt:n+1,scanDelayMs:t.scanScheduleMs[n]}),S()));if(!googletag.apiReady)return void(n===t.scanScheduleMs.length-1&&(h({issueType:"gpt_not_initialized",scanAttempt:n+1,scanDelayMs:t.scanScheduleMs[n]}),S()));const i=Array.from(document.querySelectorAll(t.domSlotSelector)).filter((e=>!c(e))).map((e=>e.id)).filter(Boolean),r=googletag.pubads().getSlots(),d=r.map((e=>e.getSlotElementId?.())).filter((e=>e&&!a(e))),m=r.filter((e=>!g(e)&&!e.getSizes().some((e=>{const t=e.getWidth?.(),s=e.getHeight?.();return l.includes(`${t}x${s}`)}))));m.map((e=>e.getSlotElementId?.())).filter((e=>e&&!a(e)));if(i.forEach((e=>{d.includes(e)||h({issueType:"slot_not_registered",slotId:e,scanAttempt:n+1,scanDelayMs:t.scanScheduleMs[n]})})),m.forEach((s=>{const o=s.getSlotElementId?.();if(!o||a(o))return;const i=s.getAdUnitPath?.();if(!i)return;const r=u(i);r&&(t.expectedNetworkId&&r&&String(r)!==String(t.expectedNetworkId)&&h({issueType:"wrong_network",slotId:o,adUnitPath:i,networkId:r,hadRequest:!0,hadResponse:!!s.getResponseInformation?.(),scanAttempt:n+1,scanDelayMs:t.scanScheduleMs[n]}),n===t.scanScheduleMs.length-1&&(f||(f=!0,function(){try{window.scrollTo(0,.8*document.body.scrollHeight),window.googletag&&googletag.apiReady&&googletag.cmd.push((function(){googletag.pubads().refresh(googletag.pubads().getSlots().filter((e=>{const t=e.getSlotElementId();return t&&!document.getElementById(t)})))}))}catch{}}()),setTimeout((()=>{const s=googletag.pubads().getSlots().filter((e=>!g(e)&&!e.getSizes().some((e=>{const t=e.getWidth?.(),s=e.getHeight?.();return l.includes(`${t}x${s}`)})))),o=s.map((e=>e.getSlotElementId())).filter((e=>e&&!a(e)));s.length>0&&0===e.size&&h({issueType:"gpt_no_slot_requests",severity:"high"}),s.forEach((s=>{if(g(s))return;const n=s.getSlotElementId?.();if(!n||a(n))return;const o=document.getElementById(n);if(o&&o.offsetWidth>0&&0===o.offsetHeight&&h({issueType:"slot_container_collapsed",slotId:n,severity:"medium"}),!s.getSizes?.().some((e=>l.includes(`${e.getWidth?.()}x${e.getHeight?.()}`)))&&!document.getElementById(n)){const o=s.getAdUnitPath?.()||"",i=u(o);if(t.expectedNetworkId&&i&&String(i)!==String(t.expectedNetworkId))return;const r=e.has(n),d=!!s.getResponseInformation?.(),l=r||d;h({issueType:l?"phantom_slot_requested":"defined_without_dom_no_request",slotId:n,adUnitPath:o,hadRequest:r,hadResponse:d,severity:l?"high":"medium"})}})),o.forEach((e=>{const s=document.getElementById(e);if(!s)return;s.querySelector("iframe")&&(window.outerWidth-window.innerWidth>200||function(e,t){const s=e.getBoundingClientRect();if(s.bottom<0||s.top>window.innerHeight)return!1;const n=[[s.left+5,s.top+5],[s.right-5,s.top+5],[s.left+5,s.bottom-5],[s.right-5,s.bottom-5],[s.left+s.width/2,s.top+s.height/2]];let o=0;for(const[s,i]of n)document.elementsFromPoint(s,i).some((s=>{if(s===e)return!1;if(e.contains(s))return!1;if(s.id&&t.includes(s.id))return!1;if(s===e.parentElement)return!1;const n=window.getComputedStyle(s);return"none"!==n.pointerEvents&&"hidden"!==n.visibility&&"none"!==n.display}))&&o++;return o>=2}(s,o)&&h({issueType:"ad_visibility_impaired",slotId:e,scanAttempt:n+1,scanDelayMs:t.scanScheduleMs[n]}))}));const i=o.map((e=>document.getElementById(e))).filter((e=>e&&e.offsetWidth>0&&e.offsetHeight>0)).map((e=>({id:e.id,rect:e.getBoundingClientRect()})));for(let e=0;e<i.length;e++)for(let s=e+1;s<i.length;s++){const o=i[e],r=i[s];p(o.rect,r.rect)&&h({issueType:"layout_overlap",slotId:`${o.id} â†” ${r.id}`,scanAttempt:n+1,scanDelayMs:t.scanScheduleMs[n]})}S()}),500)))})),s&&n===t.scanScheduleMs.length-1){const e=Array.from(document.querySelectorAll(t.domSlotSelector)).map((e=>e.id)).filter(Boolean),s=(window.googletag?.apiReady?googletag.pubads().getSlots().map((e=>e.getSlotElementId())):[]).filter(Boolean),n=s.filter((t=>!e.includes(t))),o=e.filter((e=>!s.includes(e)));console.group("[APG DEBUG]"),console.log("DOM count:",e.length),console.log("GPT count:",s.length),console.log("Phantom slots:",n),console.log("Orphan DOM slots:",o),console.groupEnd()}}(window.googletag=window.googletag||{cmd:[]}).cmd.push((function(){const s=googletag.pubads();s.__apgBound||(s.__apgBound=!0,s.addEventListener("slotRequested",(function(t){const s=t.slot?.getSlotElementId?.();s&&e.add(s)})),s.addEventListener("slotRenderEnded",(function(e){if(g(e.slot))return;const s=e.slot?.getSlotElementId?.();if(!s||a(s))return;const n=e.slot?.getAdUnitPath?.()||"";let o=!1;const i=u(n);if(t.expectedNetworkId&&i&&String(i)!==String(t.expectedNetworkId)&&(o=!0,h({issueType:"wrong_network",slotId:s,adUnitPath:n,networkId:i})),!o&&e.isEmpty&&h({issueType:"empty_response",slotId:s,adUnitPath:n}),e.size&&e.slot?.getSizes){const t=e.size[0]+"x"+e.size[1],o=e.slot.getSizes().map((e=>e.getWidth()+"x"+e.getHeight()));o.includes(t)||h({issueType:"unexpected_size",slotId:s,adUnitPath:n,renderedSize:t,definedSizes:o})}S()})))})),t.scanScheduleMs.forEach(((e,t)=>setTimeout((()=>_(t)),e)))}();
