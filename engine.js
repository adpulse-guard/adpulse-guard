!function(){if(!window.APG_CONFIG)return;const e=Object.assign({},{ignoreAnchorSlots:!0,apiEndpoint:"https://script.google.com/macros/s/AKfycbxAD4aNij0ApHx21r68hq5TLx2k2r3VT9_obEe7I-EX_l3JGDQSnrY84LcA4QG8Ldf2ig/exec",version:"start-1.2.0-appscript",scanScheduleMs:[3500,1e4,4e4],dedupeTtlMs:864e5,domSlotSelector:'div[id^="div-gpt-ad"],div[id^="gpt-"],div[id^="ad-"],div[id*="ad-slot"],div[id*="gpt-ad"],div[id*="slot"]',revenueModel:{currency:"USD",assumedRpm:1,assumedImpressionsPerHour:500}},window.APG_CONFIG);if(!e.clientId||!e.siteToken)return;location.hostname.replace(/^www\./,"");const t=Date.now().toString(36)+"-"+Math.random().toString(36).slice(2,8),n=[],o=new Set;let i=!1;const s=["1x1","2x1"];function r(e){return"string"==typeof e&&e.startsWith("google_pubconsole_overlay_")}function d(t){try{if(!t)return!0;if(e.ignoreAnchorSlots&&t.getOutOfPage?.())return!0;const n=t.getSlotElementId?.();if(!n)return!0;const o=document.getElementById(n);if(!o)return!1;const i=window.getComputedStyle(o);if("fixed"===i.position)return!0;if("sticky"===i.position)return!0}catch{}return!1}function a(e,t,n=20){const o=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left)),i=Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));return o>n&&i>n}function l(){const t=e.revenueModel.assumedImpressionsPerHour/1e3*e.revenueModel.assumedRpm;return{estimationCurrency:e.revenueModel.currency,assumedRpm:e.revenueModel.assumedRpm,assumedImpressionsPerHour:e.revenueModel.assumedImpressionsPerHour,estimatedHourlyRevenueRisk:Math.round(100*t)/100,estimatedDailyRevenueRisk:Math.round(24*t*100)/100,estimationMethod:"conservative_time_based_risk",revenueAssumptionsNote:"500 imps/hour, $1 RPM, conservative baseline"}}function c(t){try{const n=["apg",e.clientId,location.href,t.issueType,t.slotId||""].join("|"),o=localStorage.getItem(n);return!(o&&Date.now()-Number(o)<e.dedupeTtlMs)&&(localStorage.setItem(n,String(Date.now())),!0)}catch{return!0}}function u(e){if(e.slotId&&r(e.slotId))return;const t=e.issueType+"|"+(e.slotId||"");var i;o.has(t)||(o.add(t),n.push({issueType:e.issueType,slotId:e.slotId||"",adUnitPath:e.adUnitPath||"",networkId:e.networkId||"",renderedSize:e.renderedSize,definedSizes:e.definedSizes,scanAttempt:e.scanAttempt,scanDelayMs:e.scanDelayMs,severity:e.severity||(i=e.issueType,"slot_not_registered"===i||"gpt_not_loaded"===i?"high":["empty_response","unexpected_size","defined_without_dom"].includes(i)?"medium":"low")}),console.log("[APG] issue detected:",e.issueType,e.slotId))}let g=!1;function m(){if(!n.length)return;if(i)return;i=!0;const o=n.filter(c);if(!o.length)return void(i=!1);const s={clientId:e.clientId,siteToken:e.siteToken,host:location.hostname,pageUrl:location.href,timestamp:(new Date).toISOString(),tagVersion:e.version,pageLoadId:t,issueType:"multiple_issues",severity:o.some((e=>"high"===e.severity))?"high":o.some((e=>"medium"===e.severity))?"medium":"info",issues:o,...l()};fetch(e.apiEndpoint,{method:"POST",headers:{"Content-Type":"text/plain;charset=UTF-8"},body:JSON.stringify(s)}).then((()=>{})).catch((()=>{i=!1}))}function p(t){if(!window.googletag||!googletag.apiReady)return void(t===e.scanScheduleMs.length-1&&(u({issueType:"gpt_not_loaded",scanAttempt:t+1,scanDelayMs:e.scanScheduleMs[t]}),m()));const n=Array.from(document.querySelectorAll(e.domSlotSelector)).filter((e=>!function(e){return!e||(!!r(e.id)||("fixed"===window.getComputedStyle(e).position||e.offsetWidth<10||e.offsetHeight<10))}(e))).map((e=>e.id)).filter(Boolean),o=googletag.pubads().getSlots(),i=o.map((e=>e.getSlotElementId?.())).filter((e=>e&&!r(e))),l=o.filter((e=>!d(e)&&!e.getSizes().some((e=>{const t=e.getWidth?.(),n=e.getHeight?.();return s.includes(`${t}x${n}`)}))));l.map((e=>e.getSlotElementId?.())).filter((e=>e&&!r(e)));n.forEach((n=>{i.includes(n)||u({issueType:"slot_not_registered",slotId:n,scanAttempt:t+1,scanDelayMs:e.scanScheduleMs[t]})})),l.forEach((n=>{const o=n.getSlotElementId?.();if(!o||r(o))return;const i=n.getAdUnitPath?.();if(!i)return;const l=function(e){if("string"!=typeof e)return"";const t=e.match(/^\/(\d+)\//);return t?t[1]:""}(i);l&&(e.expectedNetworkId&&l!==e.expectedNetworkId&&u({issueType:"wrong_network",slotId:o,adUnitPath:i,networkId:l,scanAttempt:t+1,scanDelayMs:e.scanScheduleMs[t]}),t===e.scanScheduleMs.length-1&&(g||(g=!0,function(){try{window.scrollTo(0,.8*document.body.scrollHeight),window.googletag&&googletag.apiReady&&googletag.cmd.push((function(){googletag.pubads().refresh()}))}catch{}}()),setTimeout((()=>{const n=googletag.pubads().getSlots().filter((e=>!d(e)&&!e.getSizes().some((e=>{const t=e.getWidth?.(),n=e.getHeight?.();return s.includes(`${t}x${n}`)})))),o=n.map((e=>e.getSlotElementId())).filter((e=>e&&!r(e)));n.forEach((n=>{if(d(n))return;const o=n.getSlotElementId?.();o&&!r(o)&&(document.getElementById(o)||u({issueType:"defined_without_dom",slotId:o,adUnitPath:n.getAdUnitPath?.(),scanAttempt:t+1,scanDelayMs:e.scanScheduleMs[t]}))})),o.forEach((n=>{const i=document.getElementById(n);if(!i)return;i.querySelector("iframe")&&(window.outerWidth-window.innerWidth>200||function(e,t){const n=e.getBoundingClientRect();if(n.bottom<0||n.top>window.innerHeight)return!1;const o=[[n.left+5,n.top+5],[n.right-5,n.top+5],[n.left+5,n.bottom-5],[n.right-5,n.bottom-5],[n.left+n.width/2,n.top+n.height/2]];let i=0;for(const[n,s]of o)document.elementsFromPoint(n,s).some((n=>{if(n===e)return!1;if(e.contains(n))return!1;if(n.id&&t.includes(n.id))return!1;if(n===e.parentElement)return!1;const o=window.getComputedStyle(n);return"none"!==o.pointerEvents&&"hidden"!==o.visibility&&"none"!==o.display}))&&i++;return i>=2}(i,o)&&u({issueType:"ad_visibility_impaired",slotId:n,scanAttempt:t+1,scanDelayMs:e.scanScheduleMs[t]}))}));const i=o.map((e=>document.getElementById(e))).filter((e=>e&&e.offsetWidth>0&&e.offsetHeight>0)).map((e=>({id:e.id,rect:e.getBoundingClientRect()})));for(let n=0;n<i.length;n++)for(let o=n+1;o<i.length;o++){const s=i[n],r=i[o];a(s.rect,r.rect)&&u({issueType:"layout_overlap",slotId:`${s.id} â†” ${r.id}`,scanAttempt:t+1,scanDelayMs:e.scanScheduleMs[t]})}m()}),500)))}))}function h(){if(!n.length)return;if(i)return;i=!0;const o=n.filter(c);if(!o.length)return;const s={clientId:e.clientId,siteToken:e.siteToken,host:location.hostname,pageUrl:location.href,timestamp:(new Date).toISOString(),tagVersion:e.version,pageLoadId:t,issueType:"multiple_issues",severity:o.some((e=>"high"===e.severity))?"high":o.some((e=>"medium"===e.severity))?"medium":"info",issues:o,...l()};try{navigator.sendBeacon(e.apiEndpoint,JSON.stringify(s))}catch{}}(window.googletag=window.googletag||{cmd:[]}).cmd.push((function(){const e=googletag.pubads();e.__apgBound||(e.__apgBound=!0,e.addEventListener("slotRenderEnded",(function(e){if(d(e.slot))return;const t=e.slot?.getSlotElementId?.();if(!t||r(t))return;const n=e.slot?.getAdUnitPath?.()||"";if(e.isEmpty&&u({issueType:"empty_response",slotId:t,adUnitPath:n}),e.size&&e.slot?.getSizes){const o=e.size[0]+"x"+e.size[1],i=e.slot.getSizes().map((e=>e.getWidth()+"x"+e.getHeight()));i.includes(o)||u({issueType:"unexpected_size",slotId:t,adUnitPath:n,renderedSize:o,definedSizes:i})}})))})),e.scanScheduleMs.forEach(((e,t)=>setTimeout((()=>p(t)),e))),document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&h()})),window.addEventListener("beforeunload",h)}();
